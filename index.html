<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>English Warm-Up Games Bank</title>
  <style>
    :root {
      --primary-color: #3498db;
      --secondary-color: #4CAF50;
      --accent-color: #e74c3c;
      --warning-color: #e67e22;
      --text-primary: #2c3e50;
      --text-secondary: #666;
      --background-light: #f8f9fa;
      --background-gradient: linear-gradient(120deg, #e0f7fa 0%, #f0fff0 100%);
      --shadow-light: 0 2px 8px rgba(44, 62, 80, 0.10);
      --shadow-medium: 0 4px 16px rgba(44, 62, 80, 0.15);
      --shadow-hover: 0 8px 24px rgba(52, 152, 219, 0.18);
      --border-radius: 12px;
      --border-radius-small: 6px;
      --border-radius-large: 25px;
      --transition: all 0.3s ease;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background: var(--background-gradient);
      min-height: 100vh;
      line-height: 1.6;
      color: var(--text-primary);
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* Header Styles */
    header {
      text-align: center;
      padding: 40px 20px;
      background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      color: white;
      border-radius: 0 0 30px 30px;
      box-shadow: var(--shadow-medium);
      margin-bottom: 30px;
    }

    h1 {
      margin: 0 0 10px 0;
      font-size: clamp(2rem, 5vw, 2.7rem);
      letter-spacing: 2px;
      text-shadow: 1px 1px 6px rgba(44, 62, 80, 0.18);
      font-weight: 700;
    }

    .subtitle {
      margin: 0;
      font-size: 1.1rem;
      opacity: 0.9;
      font-weight: 300;
    }

    /* Controls Section */
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
      align-items: center;
      margin-bottom: 30px;
      padding: 0 20px;
    }

    #search-bar {
      flex: 1;
      min-width: 300px;
      max-width: 500px;
      padding: 14px 20px;
      font-size: 16px;
      border: 2px solid var(--secondary-color);
      border-radius: var(--border-radius-large);
      box-shadow: var(--shadow-light);
      transition: var(--transition);
      outline: none;
      background: white;
    }

    #search-bar:focus {
      border-color: var(--primary-color);
      box-shadow: var(--shadow-medium);
      background-color: #f8fff8;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: var(--border-radius-large);
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: var(--shadow-light);
    }

    .btn-primary {
      background: linear-gradient(90deg, var(--secondary-color) 0%, var(--primary-color) 100%);
      color: white;
    }

    .btn-primary:hover {
      background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      transform: translateY(-2px);
      box-shadow: var(--shadow-medium);
    }

    .btn-secondary {
      background: white;
      color: var(--primary-color);
      border: 2px solid var(--primary-color);
    }

    .btn-secondary:hover {
      background: var(--primary-color);
      color: white;
    }

    .btn-small {
      padding: 8px 16px;
      font-size: 0.9rem;
    }

    .btn-danger {
      background: var(--accent-color);
      color: white;
    }

    .btn-danger:hover {
      background: #c0392b;
    }

    .btn-warning {
      background: var(--warning-color);
      color: white;
    }

    .btn-warning:hover {
      background: #ca7c1b;
    }

    /* File Input Styles */
    .file-input-wrapper {
      position: relative;
      overflow: hidden;
      display: inline-block;
    }

    .file-input-wrapper input[type=file] {
      position: absolute;
      left: -9999px;
    }

    .file-input-label {
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    /* Games List */
    #games-list {
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .games-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .game-card {
      background: white;
      border: 1px solid #e0e0e0;
      padding: 24px;
      border-radius: var(--border-radius);
      position: relative;
      box-shadow: var(--shadow-light);
      transition: var(--transition);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .game-card:hover {
      box-shadow: var(--shadow-hover);
      transform: translateY(-3px);
      border-color: var(--secondary-color);
    }

    .game-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 8px;
    }

    .game-title {
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--primary-color);
      margin: 0;
      line-height: 1.3;
      flex: 1;
      margin-right: 10px;
    }

    .game-actions {
      display: flex;
      gap: 8px;
      flex-shrink: 0;
    }

    .game-description {
      color: var(--text-primary);
      margin: 0;
      line-height: 1.5;
      margin-bottom: 12px;
    }

    .game-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin-bottom: 12px;
    }

    .game-detail-item {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .game-detail-label {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .game-detail-value {
      font-size: 0.95rem;
      color: var(--text-primary);
      font-weight: 500;
    }

    .game-meta {
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    .game-tags, .game-category {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .tag {
      background: #e3f2fd;
      color: var(--primary-color);
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 500;
    }

    .category-badge {
      background: #e8f5e8;
      color: var(--secondary-color);
      padding: 4px 12px;
      border-radius: 16px;
      font-weight: 500;
    }

    .duration-badge {
      background: #fff3e0;
      color: #f57c00;
      padding: 4px 12px;
      border-radius: 16px;
      font-weight: 500;
    }

    .age-group-badge {
      background: #f3e5f5;
      color: #7b1fa2;
      padding: 4px 12px;
      border-radius: 16px;
      font-weight: 500;
    }

    .added-by-badge {
      background: #e8f5e8;
      color: #388e3c;
      padding: 4px 12px;
      border-radius: 16px;
      font-weight: 500;
    }

    .game-comments {
      background: #f8f9fa;
      padding: 12px;
      border-radius: var(--border-radius-small);
      border-left: 4px solid var(--primary-color);
      margin-top: 8px;
      font-style: italic;
      color: var(--text-secondary);
    }

    .game-image {
      margin-top: 12px;
      max-width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: var(--border-radius-small);
      box-shadow: var(--shadow-light);
    }

    /* Form Styles */
    .form-section {
      background: white;
      padding: 30px;
      margin: 40px auto;
      border-radius: var(--border-radius);
      max-width: 800px;
      box-shadow: var(--shadow-light);
    }

    .form-title {
      margin: 0 0 24px 0;
      color: var(--primary-color);
      font-size: 1.8rem;
      font-weight: 600;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    .form-label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
      color: var(--text-primary);
    }

    .form-input, .form-textarea, .form-select {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: var(--border-radius-small);
      font-size: 1rem;
      background: #fafafa;
      transition: var(--transition);
      font-family: inherit;
    }

    .form-input:focus, .form-textarea:focus, .form-select:focus {
      border-color: var(--primary-color);
      background: white;
      outline: none;
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }

    .form-textarea {
      resize: vertical;
      min-height: 100px;
    }

    /* Statistics */
    .stats-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 30px auto;
      max-width: 900px;
      padding: 0 20px;
    }

    .stat-card {
      background: white;
      padding: 24px;
      border-radius: var(--border-radius);
      text-align: center;
      box-shadow: var(--shadow-light);
      border-left: 4px solid var(--primary-color);
    }

    .stat-number {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--primary-color);
      margin: 0;
    }

    .stat-label {
      color: var(--text-secondary);
      font-weight: 500;
      margin: 8px 0 0 0;
    }

    /* Category Management */
    .category-section {
      margin: 40px auto;
      max-width: 700px;
      padding: 0 20px;
    }

    .section-title {
      color: var(--primary-color);
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 20px;
      text-align: center;
    }

    .category-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: white;
      padding: 16px 20px;
      margin: 10px 0;
      border-radius: var(--border-radius-small);
      border: 1px solid #e0e0e0;
      box-shadow: var(--shadow-light);
      transition: var(--transition);
    }

    .category-item:hover {
      box-shadow: var(--shadow-medium);
    }

    .category-name {
      font-weight: 500;
      color: var(--text-primary);
    }

    .category-actions {
      display: flex;
      gap: 8px;
    }

    /* Notifications */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 20px;
      border-radius: var(--border-radius-small);
      color: white;
      font-weight: 500;
      z-index: 1000;
      transform: translateX(400px);
      transition: var(--transition);
      box-shadow: var(--shadow-medium);
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification.success {
      background: var(--secondary-color);
    }

    .notification.error {
      background: var(--accent-color);
    }

    .notification.info {
      background: var(--primary-color);
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-secondary);
    }

    .empty-state-icon {
      font-size: 4rem;
      margin-bottom: 20px;
      opacity: 0.5;
    }

    .empty-state-title {
      font-size: 1.5rem;
      margin-bottom: 10px;
      color: var(--text-primary);
    }

    .empty-state-description {
      font-size: 1rem;
      max-width: 400px;
      margin: 0 auto;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .container {
        padding: 0 15px;
      }

      .controls {
        flex-direction: column;
        align-items: stretch;
      }

      #search-bar {
        min-width: auto;
        max-width: none;
      }

      .games-grid {
        grid-template-columns: 1fr;
      }

      .game-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .game-actions {
        align-self: flex-end;
      }

      .game-details {
        grid-template-columns: 1fr;
      }

      .form-section, .category-section {
        margin: 20px 15px;
        padding: 20px;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }

      .stats-section {
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
      }

      .stat-number {
        font-size: 2rem;
      }
    }

    @media (max-width: 480px) {
      .stats-section {
        grid-template-columns: 1fr;
      }

      .controls {
        gap: 10px;
      }

      .btn {
        padding: 10px 16px;
        font-size: 0.9rem;
      }
    }

    /* Loading Animation */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Accessibility */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    /* Focus styles for better accessibility */
    .btn:focus,
    .form-input:focus,
    .form-textarea:focus,
    .form-select:focus {
      outline: 2px solid var(--primary-color);
      outline-offset: 2px;
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>English Warm-Up Games Bank</h1>
      <p class="subtitle">Fun and engaging activities to start your English lessons!</p>
    </div>
  </header>

  <div class="container">
    <!-- Statistics Section -->
    <div class="stats-section" id="stats-section">
      <div class="stat-card">
        <div class="stat-number" id="total-games">0</div>
        <div class="stat-label">Total Games</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="total-categories">0</div>
        <div class="stat-label">Categories</div>
      </div>
    </div>

    <!-- Controls Section -->
    <div class="controls">
      <input type="text" id="search-bar" placeholder="Search games..." aria-label="Search games">
      
      <div class="file-input-wrapper">
        <input type="file" id="import-file" accept=".json" aria-label="Import JSON file">
        <label for="import-file" class="btn btn-secondary file-input-label">
          üìÅ Import JSON
        </label>
      </div>
      
      <button class="btn btn-primary" onclick="exportGames()">
        üíæ Export Games
      </button>
    </div>

    <!-- Games List -->
    <section id="games-list">
      <div class="games-grid" id="games-grid"></div>
      <div class="empty-state" id="empty-state" style="display: none;">
        <div class="empty-state-icon">üéÆ</div>
        <div class="empty-state-title">No games found</div>
        <div class="empty-state-description">
          Add your first game using the form below or import a JSON file.
        </div>
      </div>
    </section>

    <!-- Game Form -->
    <div class="form-section">
      <form id="game-form">
        <h2 class="form-title" id="form-title">Add New Game</h2>
        
        <div class="form-grid">
          <div class="form-group full-width">
            <label for="title" class="form-label">Activity Name *</label>
            <input type="text" id="title" class="form-input" placeholder="Enter the activity name" required>
          </div>
          
          <div class="form-group">
            <label for="duration" class="form-label">Duration</label>
            <select id="duration" class="form-select">
              <option value="">Select duration</option>
              <option value="5-10 min">5-10 minutes</option>
              <option value="10-15 min">10-15 minutes</option>
              <option value="15-20 min">15-20 minutes</option>
              <option value="20-30 min">20-30 minutes</option>
              <option value="30+ min">30+ minutes</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="age-group" class="form-label">Age Group</label>
            <select id="age-group" class="form-select">
              <option value="">Select age group</option>
              <option value="Children (6-10)">Children (6-10)</option>
              <option value="Pre-teens (11-13)">Pre-teens (11-13)</option>
              <option value="Teenagers (14-17)">Teenagers (14-17)</option>
              <option value="Adults (18+)">Adults (18+)</option>
              <option value="All ages">All ages</option>
            </select>
          </div>
          
          <div class="form-group full-width">
            <label for="description" class="form-label">Description *</label>
            <textarea id="description" class="form-textarea" placeholder="Describe how to play..." required></textarea>
          </div>
          
          <div class="form-group">
            <label for="tags" class="form-label">Tags</label>
            <input type="text" id="tags" class="form-input" placeholder="speaking, vocabulary, grammar (comma separated)">
          </div>
          
          <div class="form-group">
            <label for="category" class="form-label">Category</label>
            <select id="category" class="form-select">
              <option value="">Select Category</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="new-category" class="form-label">Or create new category</label>
            <input type="text" id="new-category" class="form-input" placeholder="New category name">
          </div>
          
          <div class="form-group">
            <label for="added-by" class="form-label">Added By</label>
            <input type="text" id="added-by" class="form-input" placeholder="Teacher/creator name">
          </div>
          
          <div class="form-group full-width">
            <label for="image" class="form-label">Image URL (optional)</label>
            <input type="url" id="image" class="form-input" placeholder="https://example.com/image.jpg">
          </div>
          
          <div class="form-group full-width">
            <label for="comments" class="form-label">Comments</label>
            <textarea id="comments" class="form-textarea" placeholder="Additional tips, game variations, observations..."></textarea>
          </div>
        </div>
        
        <button type="submit" class="btn btn-primary">
          üíæ Save Game
        </button>
      </form>
    </div>

    <!-- Categories Management -->
    <div class="category-section">
      <h3 class="section-title">Manage Categories</h3>
      <div id="category-list"></div>
    </div>
  </div>

  <!-- Notification Container -->
  <div id="notification-container"></div>

  <script>
    // Constants and Configuration
    const STORAGE_KEYS = {
      GAMES: 'warmup_games_v2',
      CATEGORIES: 'warmup_categories_v2'
    };

    const NOTIFICATION_DURATION = 3000;

    // Global State
    let games = [];
    let categories = [];
    let editIndex = null;
    let filteredGames = [];

    // Utility Functions
    function generateId() {
      return Date.now().toString(36) + Math.random().toString(36).substr(2);
    }

    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }

    function sanitizeInput(input) {
      const div = document.createElement('div');
      div.textContent = input;
      return div.innerHTML;
    }

    function validateImageUrl(url) {
      if (!url) return true;
      try {
        new URL(url);
        return true;
      } catch {
        return false;
      }
    }

    // Notification System
    function showNotification(message, type = 'info') {
      const container = document.getElementById('notification-container');
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      
      container.appendChild(notification);
      
      // Trigger animation
      setTimeout(() => notification.classList.add('show'), 100);
      
      // Remove notification
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => container.removeChild(notification), 300);
      }, NOTIFICATION_DURATION);
    }

    // Data Management
    function loadData() {
      try {
        const gamesData = localStorage.getItem(STORAGE_KEYS.GAMES);
        const categoriesData = localStorage.getItem(STORAGE_KEYS.CATEGORIES);
        
        games = gamesData ? JSON.parse(gamesData) : [];
        categories = categoriesData ? JSON.parse(categoriesData) : [];
        
        // Ensure all games have IDs and new fields
        games = games.map(game => ({
          id: game.id || generateId(),
          title: game.title || '',
          description: game.description || '',
          tags: game.tags || '',
          category: game.category || '',
          image: game.image || '',
          duration: game.duration || '',
          ageGroup: game.ageGroup || '',
          addedBy: game.addedBy || '',
          comments: game.comments || '',
          createdAt: game.createdAt || new Date().toISOString(),
          updatedAt: game.updatedAt || new Date().toISOString(),
          ...game
        }));
        
        filteredGames = [...games];
        
        showNotification('Data loaded successfully!', 'success');
      } catch (error) {
        console.error('Error loading data:', error);
        showNotification('Error loading saved data', 'error');
        games = [];
        categories = [];
        filteredGames = [];
      }
    }

    function saveData() {
      try {
        localStorage.setItem(STORAGE_KEYS.GAMES, JSON.stringify(games));
        localStorage.setItem(STORAGE_KEYS.CATEGORIES, JSON.stringify(categories));
        showNotification('Data saved successfully!', 'success');
      } catch (error) {
        console.error('Error saving data:', error);
        showNotification('Error saving data', 'error');
      }
    }

    // Statistics
    function updateStatistics() {
      document.getElementById('total-games').textContent = games.length;
      document.getElementById('total-categories').textContent = categories.length;
    }

    // Category Management
    function updateCategoryOptions() {
      const categorySelect = document.getElementById('category');
      categorySelect.innerHTML = '<option value="">Select Category</option>';
      
      categories.forEach(cat => {
        const option = document.createElement('option');
        option.value = cat;
        option.textContent = cat;
        categorySelect.appendChild(option);
      });
      
      updateCategoryList();
    }

    function updateCategoryList() {
      const list = document.getElementById('category-list');
      
      if (categories.length === 0) {
        list.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">No categories created yet.</p>';
        return;
      }
      
      list.innerHTML = '';
      categories.forEach((cat, index) => {
        const item = document.createElement('div');
        item.className = 'category-item';
        item.innerHTML = `
          <span class="category-name">${sanitizeInput(cat)}</span>
          <div class="category-actions">
            <button class="btn btn-small btn-warning" onclick="editCategory(${index})" aria-label="Edit category ${sanitizeInput(cat)}">
              ‚úèÔ∏è Edit
            </button>
            <button class="btn btn-small btn-danger" onclick="deleteCategory(${index})" aria-label="Delete category ${sanitizeInput(cat)}">
              üóëÔ∏è Delete
            </button>
          </div>
        `;
        list.appendChild(item);
      });
    }

    function editCategory(index) {
      const currentName = categories[index];
      const newName = prompt("Edit category name:", currentName);
      
      if (newName && newName.trim() && newName !== currentName) {
        const trimmedName = newName.trim();
        
        if (categories.includes(trimmedName)) {
          showNotification('This category already exists!', 'error');
          return;
        }
        
        // Update category in games
        games = games.map(game => {
          if (game.category === currentName) {
            return { ...game, category: trimmedName };
          }
          return game;
        });
        
        categories[index] = trimmedName;
        saveData();
        updateCategoryOptions();
        displayGames();
        showNotification('Category updated successfully!', 'success');
      }
    }

    function deleteCategory(index) {
      const catToDelete = categories[index];
      
      if (confirm(`Are you sure you want to delete the category "${catToDelete}"? Games in this category will not be deleted, they will just be uncategorized.`)) {
        categories.splice(index, 1);
        
        // Remove category from games
        games = games.map(game => {
          if (game.category === catToDelete) {
            return { ...game, category: '' };
          }
          return game;
        });
        
        saveData();
        updateCategoryOptions();
        displayGames();
        showNotification('Category deleted successfully!', 'success');
      }
    }

    // Game Display
    function displayGames(gamesToShow = filteredGames) {
      const grid = document.getElementById('games-grid');
      const emptyState = document.getElementById('empty-state');
      
      if (gamesToShow.length === 0) {
        grid.innerHTML = '';
        emptyState.style.display = 'block';
        return;
      }
      
      emptyState.style.display = 'none';
      grid.innerHTML = '';
      
      gamesToShow.forEach((game, index) => {
        const originalIndex = games.findIndex(g => g.id === game.id);
        const card = document.createElement('div');
        card.className = 'game-card';
        
        const tags = game.tags ? game.tags.split(',').map(tag => tag.trim()).filter(tag => tag) : [];
        const tagsHtml = tags.map(tag => `<span class="tag">${sanitizeInput(tag)}</span>`).join('');
        
        card.innerHTML = `
          <div class="game-header">
            <h3 class="game-title">${sanitizeInput(game.title)}</h3>
            <div class="game-actions">
              <button class="btn btn-small btn-primary" onclick="editGame(${originalIndex})" aria-label="Edit game ${sanitizeInput(game.title)}">
                ‚úèÔ∏è
              </button>
              <button class="btn btn-small btn-danger" onclick="deleteGame(${originalIndex})" aria-label="Delete game ${sanitizeInput(game.title)}">
                üóëÔ∏è
              </button>
            </div>
          </div>
          
          <p class="game-description">${sanitizeInput(game.description)}</p>
          
          <div class="game-details">
            ${game.duration ? `
              <div class="game-detail-item">
                <div class="game-detail-label">Duration</div>
                <div class="game-detail-value">
                  <span class="duration-badge">${sanitizeInput(game.duration)}</span>
                </div>
              </div>
            ` : ''}
            
            ${game.ageGroup ? `
              <div class="game-detail-item">
                <div class="game-detail-label">Age Group</div>
                <div class="game-detail-value">
                  <span class="age-group-badge">${sanitizeInput(game.ageGroup)}</span>
                </div>
              </div>
            ` : ''}
            
            ${game.addedBy ? `
              <div class="game-detail-item">
                <div class="game-detail-label">Added By</div>
                <div class="game-detail-value">
                  <span class="added-by-badge">${sanitizeInput(game.addedBy)}</span>
                </div>
              </div>
            ` : ''}
            
            ${game.category ? `
              <div class="game-detail-item">
                <div class="game-detail-label">Category</div>
                <div class="game-detail-value">
                  <span class="category-badge">${sanitizeInput(game.category)}</span>
                </div>
              </div>
            ` : ''}
          </div>
          
          <div class="game-meta">
            ${tags.length > 0 ? `<div class="game-tags"><strong>Tags:</strong> ${tagsHtml}</div>` : ''}
          </div>
          
          ${game.comments ? `
            <div class="game-comments">
              <strong>Comments:</strong> ${sanitizeInput(game.comments)}
            </div>
          ` : ''}
          
          ${game.image ? `<img src="${game.image}" alt="Image for game ${sanitizeInput(game.title)}" class="game-image" onerror="this.style.display='none'">` : ''}
        `;
        
        grid.appendChild(card);
      });
    }

    // Search and Filter
    const debouncedFilter = debounce(function() {
      const query = document.getElementById('search-bar').value.toLowerCase().trim();
      
      if (!query) {
        filteredGames = [...games];
      } else {
        filteredGames = games.filter(game =>
          game.title.toLowerCase().includes(query) ||
          game.description.toLowerCase().includes(query) ||
          (game.tags && game.tags.toLowerCase().includes(query)) ||
          (game.category && game.category.toLowerCase().includes(query)) ||
          (game.duration && game.duration.toLowerCase().includes(query)) ||
          (game.ageGroup && game.ageGroup.toLowerCase().includes(query)) ||
          (game.addedBy && game.addedBy.toLowerCase().includes(query)) ||
          (game.comments && game.comments.toLowerCase().includes(query))
        );
      }
      
      displayGames();
    }, 300);

    function filterGames() {
      debouncedFilter();
    }

    // Game CRUD Operations
    function deleteGame(index) {
      const game = games[index];
      
      if (confirm(`Are you sure you want to delete the game "${game.title}"?`)) {
        games.splice(index, 1);
        filteredGames = filteredGames.filter(g => g.id !== game.id);
        saveData();
        displayGames();
        updateStatistics();
        showNotification('Game deleted successfully!', 'success');
      }
    }

    function editGame(index) {
      const game = games[index];
      
      document.getElementById('title').value = game.title;
      document.getElementById('description').value = game.description;
      document.getElementById('tags').value = game.tags || '';
      document.getElementById('category').value = game.category || '';
      document.getElementById('new-category').value = '';
      document.getElementById('image').value = game.image || '';
      document.getElementById('duration').value = game.duration || '';
      document.getElementById('age-group').value = game.ageGroup || '';
      document.getElementById('added-by').value = game.addedBy || '';
      document.getElementById('comments').value = game.comments || '';
      document.getElementById('form-title').textContent = 'Edit Game';
      
      editIndex = index;
      
      // Scroll to form
      document.getElementById('game-form').scrollIntoView({ behavior: 'smooth' });
      document.getElementById('title').focus();
    }

    function resetForm() {
      document.getElementById('game-form').reset();
      document.getElementById('form-title').textContent = 'Add New Game';
      editIndex = null;
    }

    // Form Handling
    document.getElementById('game-form').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const title = document.getElementById('title').value.trim();
      const description = document.getElementById('description').value.trim();
      const tags = document.getElementById('tags').value.trim();
      let category = document.getElementById('category').value.trim();
      const newCategory = document.getElementById('new-category').value.trim();
      const image = document.getElementById('image').value.trim();
      const duration = document.getElementById('duration').value.trim();
      const ageGroup = document.getElementById('age-group').value.trim();
      const addedBy = document.getElementById('added-by').value.trim();
      const comments = document.getElementById('comments').value.trim();
      
      // Validation
      if (!title || !description) {
        showNotification('Activity name and description are required!', 'error');
        return;
      }
      
      if (image && !validateImageUrl(image)) {
        showNotification('Invalid image URL!', 'error');
        return;
      }
      
      // Handle new category
      if (newCategory) {
        if (!categories.includes(newCategory)) {
          categories.push(newCategory);
          category = newCategory;
          updateCategoryOptions();
        } else {
          category = newCategory;
        }
      }
      
      const gameData = {
        id: editIndex !== null ? games[editIndex].id : generateId(),
        title,
        description,
        tags,
        category,
        image,
        duration,
        ageGroup,
        addedBy,
        comments,
        createdAt: editIndex !== null ? games[editIndex].createdAt : new Date().toISOString(),
        updatedAt: new Date().toISOString()
      };
      
      if (editIndex !== null) {
        games[editIndex] = gameData;
        // Update in filtered games too
        const filteredIndex = filteredGames.findIndex(g => g.id === gameData.id);
        if (filteredIndex !== -1) {
          filteredGames[filteredIndex] = gameData;
        }
        showNotification('Game updated successfully!', 'success');
      } else {
        games.push(gameData);
        filteredGames.push(gameData);
        showNotification('Game added successfully!', 'success');
      }
      
      saveData();
      displayGames();
      updateStatistics();
      resetForm();
    });

    // Import/Export Functions
    function exportGames() {
      try {
        const dataToExport = {
          games,
          categories,
          exportDate: new Date().toISOString(),
          version: '2.0'
        };
        
        const dataStr = JSON.stringify(dataToExport, null, 2);
        const blob = new Blob([dataStr], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = `english-warmup-games-${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        showNotification('File exported successfully!', 'success');
      } catch (error) {
        console.error('Error exporting:', error);
        showNotification('Error exporting file', 'error');
      }
    }

    function importGames(file) {
      const reader = new FileReader();
      
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          
          // Validate data structure
          if (!data.games || !Array.isArray(data.games)) {
            throw new Error('Invalid file format');
          }
          
          // Confirm import
          const confirmMessage = `Import ${data.games.length} games and ${(data.categories || []).length} categories? This will replace all current data.`;
          
          if (confirm(confirmMessage)) {
            // Import data with new fields
            games = data.games.map(game => ({
              id: game.id || generateId(),
              title: game.title || '',
              description: game.description || '',
              tags: game.tags || '',
              category: game.category || '',
              image: game.image || '',
              duration: game.duration || '',
              ageGroup: game.ageGroup || '',
              addedBy: game.addedBy || '',
              comments: game.comments || '',
              createdAt: game.createdAt || new Date().toISOString(),
              updatedAt: new Date().toISOString(),
              ...game
            }));
            
            categories = data.categories || [];
            filteredGames = [...games];
            
            saveData();
            updateCategoryOptions();
            displayGames();
            updateStatistics();
            
            showNotification(`${games.length} games imported successfully!`, 'success');
          }
        } catch (error) {
          console.error('Error importing:', error);
          showNotification('Error importing file. Please check the format is correct.', 'error');
        }
      };
      
      reader.readAsText(file);
    }

    // Event Listeners
    document.getElementById('search-bar').addEventListener('input', filterGames);

    document.getElementById('import-file').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        if (file.type !== 'application/json') {
          showNotification('Please select a valid JSON file.', 'error');
          return;
        }
        importGames(file);
      }
      // Reset file input
      e.target.value = '';
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
      // Ctrl/Cmd + K to focus search
      if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
        e.preventDefault();
        document.getElementById('search-bar').focus();
      }
      
      // Escape to clear search
      if (e.key === 'Escape' && document.activeElement === document.getElementById('search-bar')) {
        document.getElementById('search-bar').value = '';
        filterGames();
      }
    });

    // Initialize Application
    function initializeApp() {
      loadData();
      updateCategoryOptions();
      displayGames();
      updateStatistics();
      
      // Focus search bar
      document.getElementById('search-bar').focus();
    }

    // Start the application
    document.addEventListener('DOMContentLoaded', initializeApp);
  </script>
</body>
</html>
